```
u t m
sy
sy sw2
vlan batch 10 20
port-group group-member g0/0/2 g0/0/1
port link-type trunk
port trunk allow-pass vlan 10 20



return
sy
stp mode mstp 
stp region-configuration
region-name ntd
instance 1 vlan 10
instance 2 vlan 20
active region-configuration

stp instance 1 priority 4096

display stp brief



u t m 
sy
sy s3
vlan batch 2 3 4

dhcp enable
int g 0/0/0
ip add 192.168.1.254 24
dhcp select interface
dhcp server dns-list 8.8.8.8
dhcp server lease day 3
dhcp server excluded-ip-address 192.168.1.250 192.168.1.253

u t m 
sy
sy s1
vlan 
port-group 1
group-member g0/0/1 g0/0/2
port link-type access
port defult vlan 2
dhcp enable
ip pool ntd
network 192.168.2.0 mask 24
dns-list 8.8.8.8
gateway 192.168.2.254

interface vlan 2
ip address 192.168.2.254 24
dhcp select global


u t m
sy 
sy s2
user-interface con 0
id 0
q
vlan batch 30 40
port-group group-member g0/0/1 g0/0/2
port link-type access
q
int g0/0/1
port default vlan 30
int g0/0/2
port default vlan 40


u t m
sy 
sy s3
user-interface con 0
id 0
q
vlan batch 10 20 30 40 
port-group group-member g0/0/5 g0/0/6
port link-type trunk
port trunk allow-pass vlan all 

dhcp enable
ip pool vlan10
network 192.168.10.0 mask 24
gateway 192.168.10.254
dns-list 8.8.8.8
int vl 10
ip add 192.168.10.254 24
dhcp select global
return
sy
ip pool vlan20
network 192.168.20.0 mask 24
gateway 192.168.20.254
dns-list 8.8.8.8
int vl 20
ip add 192.168.20.254 24
dhcp select global
return
sy
ip pool vlan30
network 192.168.30.0 mask 24
gateway 192.168.30.254
dns-list 8.8.8.8
int vl 30
ip add 192.168.30.254 24
dhcp select global
return
sy
ip pool vlan40
network 192.168.40.0 mask 24
gateway 192.168.40.254
dns-list 8.8.8.8
int vl 40
ip add 192.168.40.254 24
dhcp select global
return
sy

int g0/0/6
port link-type trunk
port trunk allow-pass vlan 30 40

192.168.40.1
255.255.255.0
192.168.40.254

u t m 
sy 
sy s4
vlan batch 10 20 30 40 50
int g0/0/3
por li a
po de v 30
int g0/0/4
por li a
po de v 40
port-g g g0/0/1 g0/0/2
por li tr
por tr all vl all

u t m 
sy 
sy s6
vlan batch 10 20 30 40 50
port-group group-member g0/0/1 to g0/0/6
port link-type trunk
port tr all vlan all

u t m 
sy 
sy s7
vlan batch 10 20 30 40 50
port-group group-member g0/0/1 g0/0/3
port link-type trunk
port tr all vlan all
q
int g 0/0/2
por lin access
por de vl 50
q
interface vlan 10
ip add 192.168.10.254 24
interface vlan 20
ip add 192.168.20.254 24
interface vlan 30
ip add 192.168.30.254 24
interface vlan 40
ip add 192.168.40.254 24
interface vlan 50
ip add 192.168.50.254 24


u t m 
sy
stp region-configuration 
region-name ntd
instance 10 vlan 10
instance 20 vlan 20
instance 30 vlan 30
instance 40 vlan 40
active region-configuration

stp instance 10 priority 0
stp instance 30 priority 0

stp instance 20 priority 0
stp instance 40 priority 0



u t m 
sy
sy r2
user con 0
id 0
q
int g0/0/0
ip ad 192.168.30.254 24
int g0/0/2 
ip ad 192.168.40.2 24
q
ip route-static 192.168.10.0 24 192.168.40.1  preference 70

u t m 
sy
sy r3
user con 0
id 0
q
int g0/0/0
ip ad 192.168.12.3 24
int g0/0/1
ip ad 192.168.23.3 24
int g0/0/2
ip ad 192.168.3.254 24


int g0/0/0
vrrp vrid 1 virtual-ip 192.168.1.254 
vrrp vrid 1 priority 130
display vrrp brief

ip route-static 192.168.3.0 24 192.168.23.3

ip route-static 192.168.1.0 24 192.168.13.1
ip route-static 192.168.1.0 24 192.168.23.1 preference 70

int g0/0/0 
vrrp vrid 1 track int g0/0/1 reduced 50









192.168.30.1
255.255.255.0
192.168.30.254










u t m 
sy 
user-int con 0
id 0
q

vlan batch 10 20 30 40 50 60
q


vlan 40
q
int vlan 40
ip add 100.1.1.1 24
q
vlan batch 10 20 30
port-group group-member g0/0/1 g0/0/5  g0/0/6
port lin tr 
por t a v a 
q




vlan bat 10 20 30 40
int vl 10
ip add 192.168.10.251 24
vrrp vrid 10 virtual-ip 192.168.10.254 
vrrp vrid 10 priority 130

int vl 20
ip add 192.168.20.251 24
vrrp vrid 20 virtual-ip 192.168.20.254 
vrrp vrid 20 priority 130

int vl 30
ip add 192.168.30.251 24
vrrp vrid 30 virtual-ip 192.168.30.254 
vrrp vrid 30 priority 70




vlan bat 10 20 30 40

int vl 10
ip add 192.168.10.252 24
vrrp vrid 10 virtual-ip 192.168.10.254 

int vl 20
ip add 192.168.20.252 24
vrrp vrid 20 virtual-ip 192.168.20.254 

int vl 30
ip add 192.168.30.252 24
vrrp vrid 30 virtual-ip 192.168.30.254 


port-group group-member g0/0/1 to g0/0/5
port lin tr 
por t a v a 
q

stp region-configuration 
region-name ntd
instance 10 vlan 10
instance 20 vlan 20
instance 30 vlan 30
active region-configuration
stp instance 30 priority 0


dhcp enable
vlan ba 10 20 30
ip pool vla10
network 192.168.10.0 mask 24
gateway 192.168.10.254
dns-list 8.8.8.8
q
ip pool vla20
network 192.168.20.0 mask 24
gateway 192.168.20.254
dns-list 8.8.8.8
q
ip pool vla30
network 192.168.30.0 mask 24
gateway 192.168.30.254
dns-list 8.8.8.8
q



vlan batch 10 20 30 40
port-group group-member g0/0/1 g0/0/2 g0/0/3
port lin tr 
por t a v a 
q






dhcp enable

int vl 30 
dhcp select relay
dhcp relay server-ip 192.168.30.1

int vl 20 
dhcp select relay
dhcp relay server-ip 192.168.20.1

int vl 10 
dhcp select relay
dhcp relay server-ip 192.168.10.1

ip route-static 192.168.10.0 24 192.168.10.254
ip route-static 192.168.20.0 24 192.168.20.254
ip route-static 192.168.30.0 24 192.168.30.254
                  




u t m 
sy 
user-int con 0
id 0
q

vlan batch 10 20 30 40 50 60
q
sy
port-group group-member g0/0/2 g0/0/3
port lin tr 
por t a v a 
q


stp region-configuration 
region-name ntd
instance 10 vlan 10
instance 20 vlan 20
instance 30 vlan 30
active region-configuration

stp instance 10 priority 0
stp instance 20 priority 0


int vl 10
ip add 192.168.10.251 24
vrrp vrid 10 virtual-ip 192.168.10.254 

int vl 20
ip add 192.168.20.251 24
vrrp vrid 20 virtual-ip 192.168.20.254 

int vl 30
ip add 192.168.30.251 24
vrrp vrid 30 virtual-ip 192.168.30.254 


int vl 10 
dhcp select relay
dhcp relay server-ip 192.168.50.1
int vl 20 
dhcp select relay
dhcp relay server-ip 192.168.50.1


ip route-static 192.168.10.0 24 192.168.50.3
ip route-static 192.168.20.0 24 192.168.50.3
ip route-static 192.168.30.0 24 192.168.50.2







  int g 0/0/0
  ip add 192.168.1.252 24

  int g 0/0/1
  ip add 192.168.4.1 24

int g 0/0/0
vrrp vrid 2 virtual-ip 192.168.1.253 
vrrp vrid 2 priority 70

u t m 
sy
int g0/0/0
vrrp vrid 1 track int g0/0/1 reduced 50

u t m 
sy
user-interface console 0
idle-timeout 0
q

vlan batch 10 20 30

int g0/0/2
port link-type access
port default vlan 20
q

port-group group-member g0/0/1 g0/0/2
port link-type trunk
port trunk allow-pass vlan all
q

int g0/0/4
port link-type trunk
port trunk allow-pass vlan all
q


u t m 
sy
user-interface console 0
idle-timeout 0
q
vlan batch 10 20 30 40
port-group group-member g0/0/2 g0/0/4
port link-type trunk
port trunk allow-pass vlan all
q


int vl 30
ip add 192.168.30.254 24

int vl 10
ip add 192.168.10.251 24
vrrp vrid 10 virtual-ip 192.168.10.254
vrrp vrid 10 priority 130
int vl 20
ip add 192.168.20.251 24
vrrp vrid 10 virtual-ip 192.168.20.254
vrrp vrid 10 priority 70

int vl 10
ip add 192.168.10.252 24
vrrp vrid 10 virtual-ip 192.168.10.254
int vl 20
ip add 192.168.20.252 24
vrrp vrid 10 virtual-ip 192.168.20.254

int vl 40
ip add 192.168.40.2 24


ip rou 192.168.20.0 24 192.168.40.3 preference 70
ip rou 192.168.10.0 24 192.168.40.3




ping 192.168.40.1

stp region-configuration 
region-name ntd
instance 10 vlan 10
instance 20 vlan 20
active region-configuration

stp instance 20 priority 0



int g 0/0/24
port link-type trunk
port trunk allow-pass vlan all
q


int vl 20
vrrp vrid 20 track int g0/0/2 reduced 50


u t m 
sy
user-interface console 0
idle-timeout 0
q

int g 0/0/0
ip add 192.168.1.254 24


int g 0/0/1
ip add 192.168.12.2 24
int g 0/0/0
ip add 192.168.24.2 24

int g 0/0/2
ip add 192.168.13.3 24
int g 0/0/1
ip add 192.168.34.3 24

int g 0/0/1
ip add 192.168.24.4 24
int g 0/0/2
ip add 192.168.34.4 24
int g0/0/0
ip add 192.168.2.254 24





u t m 
sy
user-interface console 0
idle-timeout 0
q
ip rou 192.168.2.0 24 192.168.12.2
ip rou 192.168.2.0 24 192.168.13.3 preference 70

ip rou 192.168.24.0 24 192.168.12.2
ip rou 192.168.24.0 24 192.168.13.3 preference 70

ip rou 192.168.34.0 24 192.168.13.3
ip rou 192.168.34.0 24 192.168.12.2 preference 70




u t m 
sy
user-interface console 0
idle-timeout 0
q
ip rou 192.168.2.0 24 192.168.24.4
IP rou 192.168.1.0 24 192.168.12.1

ip rou 192.168.34.0 24 192.168.24.4
IP rou 192.168.13.0 24 192.168.12.1



u t m 
sy
user-interface console 0
idle-timeout 0
q
IP rou 192.168.1.0 24 192.168.13.1
IP rou 192.168.2.0 24 192.168.34.4
IP rou 192.168.12.0 24 192.168.13.1
IP rou 192.168.24.0 24 192.168.34.4


u t m 
sy
user-interface console 0
idle-timeout 0
q
IP route-static 192.168.1.0 24 192.168.24.2
IP route-static 192.168.1.0 24 192.168.34.3
IP route-static 192.168.12.0 24 192.168.24.2
IP route-static 192.168.13.0 24 192.168.34.4


bfd 
q
bfd ntd666 bind peer-ip 192.168.24.4
discriminator local 1
discriminator remote 4
min-tx-interval 10
min-rx-interval 10


bfd 
q
bfd ntd666 bind peer-ip 192.168.12.1
discriminator local 4
discriminator remote 1
min-tx-interval 10	*发送心跳* 
min-rx-interval 10	*接收心跳* 
ip route-static 192.168.20.24 track bfd-session ntd666 *绑定路由*
 
```




![配置](https://raw.githubusercontent.com/swdxiaoxiao/imgs/main/小书匠/1701329788635.png)



sw2
```
u t m
sy
vlan ba 10 20 30 40
int g 0/0/1
p l a
p d v 10
int g0/0/2
p l a 
p d v 20
```
sw3
```
u t m
sy
vlan ba 10 20 30 40
int g 0/0/1
p l a
p d v 30
int g0/0/2
p l a 
p d v 40
```




AR1:
```
u t m
system-view
sy AR1
user-in co 0
id 0
q
vlan 10
q
int g0/0/0
ip add 192.168.1.251 24
vrrp vrid 1 virtual-ip 192.168.1.254
vrrp vrid 1 priority 130
int g0/0/1
ip add 192.168.13.1 24
q
int g0/0/0
vrrp vrid 1 track int g0/0/1 re 50
```
AR2:
```
u t m
system-view
sy AR2
user-in co 0
id 0
q
vlan 10
q
int g0/0/0
ip add 192.168.1.252 24
vrrp vrid 1 virtual-ip 192.168.1.254
int g0/0/2
ip add 192.168.23.1 24

```
AR3
```
u t m
system-view
sy AR3
user-in co 0
id 0
q
vlan 10
q
int g0/0/1
ip add 192.168.13.2 24
int g0/0/2
ip add 192.168.23.2 24
int g0/0/0
ip add 192.168.2.254 24
ip rou 192.168.2.0 24 192.168.13.1 pre 70
ip rou 192.168.2.0 24 192.168.23.1
```
# 子网划分与DHCP
#### 关闭屏保(all)
```u t m
system-view
user-in co 0
id 0
q
```
#### 改变接口模式(lsw2)
```
u t m
system-view
sy SW2
user-in co 0
id 0
q
vlan batch 10 20 30 40 
int g 0/0/2
p l a
p d v 10
int g0/0/3
p l a
p d v 20
int g 0/0/1
p l t
p t a v a
```
#### 改变接口模式(lsw3)
```
u t m
system-view
sy SW3
user-in co 0
id 0
q
vlan batch 10 20 30 40 
int g 0/0/2
p l a
p d v 30
int g0/0/3
p l a
p d v 40
int g 0/0/1
p l t
p t a v a
```
#### 配置DHCP自动分发(lsw1子网划分)
```
u t m 
sy
sy DHCP
vlan batch 10 20 30 40 
user-interface con 0
idle-timeout 0 0
q
vlan batch 10 20 30 40
dhcp enable
ip pool 10
gateway-list 192.168.100.126 
network 192.168.100.0 mask 255.255.255.128 
dns-list 8.8.8.8 
ip pool 20
gateway-list 192.168.100.190 
network 192.168.100.128 mask 255.255.255.192 
dns-list 8.8.8.8 
ip pool 30
gateway-list 192.168.100.222 
network 192.168.100.192 mask 255.255.255.224 
dns-list 8.8.8.8 
ip pool 40
gateway-list 192.168.100.254 
network 192.168.100.224 mask 255.255.255.224 
dns-list 8.8.8.8 

interface Vlanif10
ip address 192.168.100.126 255.255.255.128 
dhcp select global
interface Vlanif20
ip address 192.168.100.190 255.255.255.192 
dhcp select global
interface Vlanif30
ip address 192.168.100.222 255.255.255.224 
dhcp select global
interface Vlanif40
ip address 192.168.100.254 255.255.255.224 
dhcp select global

interface GigabitEthernet0/0/1
port link-type trunk
port trunk allow-pass vlan 2 to 4094
interface GigabitEthernet0/0/2
port link-type trunk
port trunk allow-pass vlan 2 to 4094
```




# ACL1
#### AR1
```
u t m
system-view
user-in co 0
id 0
q
int g0/0/0
ip add 192.168.100.254
int g0/0/1
ip add 192.168.1.254
int g0/0/2
ip add 192.168.2.254 24
q
acl 2000
rule 10 deny source 192.168.1.1 0.0.0.0
rule 20 permit source 192.168.1.0 0.0.0.255
int g0/0/0
traffic-filter outbound acl 2000
```

# ACL2
#### 拓扑图和实验需求
![拓扑图和实验需求](https://raw.githubusercontent.com/swdxiaoxiao/imgs/main/小书匠/1701411859520.png)
#### LSW1
```
u t m
system-view
user-in co 0
id 0
q
vlan batch 10 20
port g g0/0/1 g0/0/2
p l a
p d v 10
```
#### LSW2
```
u t m
system-view
user-in co 0
id 0
q
vlan batch 10 20
port g g0/0/1 g0/0/2
p l a
p d v 20
```
#### AR1
```
u t m
system-view
user-in co 0
id 0
q
int g0/0/1
ip address 192.168.1.254 24
int g0/0/0
ip address 192.168.12.1 24
q
ip rou 192.168.2.0 24 192.168.12.2
ip rou 192.168.3.0 24 192.168.12.2

```
#### AR2
```
u t m
system-view
user-in co 0
id 0
q
int g0/0/2
ip address 192.168.3.254 24
int g0/0/0
ip address 192.168.12.2 24
int g0/0/1
ip address 192.168.2.254 24
q
ip rou 192.168.1.0 24 192.168.12.1
acl 2000
rule 10 deny source 192.168.1.0 0.0.0.255
int g0/0/2
traffic-filter outbound acl 2000

```
### ACL3
```
u t m
system-view
user-in co 0
id 0
q

```
```
int g0/0/0
ip add 192.168.12.2 24
int g0/0/1
ip add 192.168.23.2 24
int g0/0/2
ip add 192.168.2.254  24
q

```
```
ip rou 192.168.1.0 24 192.168.12.1
ip rou 192.168.3.0 24 192.168.23.3

```
```
rule 10 permit tcp source 192.168.1.1 0.0.0.0 destination-port eq 80
rule 20 permit ip source 192.168.1.1 0.0.0.0 destination 192.168.2.0 0.0.0.255
rule 30 deny ip source 192.168.1.1 0.0.0.0 destination any

```

### NAT
#### AR1
```
u t m 
sy
sy AR1
user-interface console 0
idle-timeout 0
q
int g0/0/1
ip add 192.168.1.254 24
int g0/0/0
ip add 100.1.1.1 29
nat static global 100.1.1.3 inside 192.168.1.1
q
ip rou 0.0.0.0 0 100.1.1.2

```
#### AR2
```
u t m 
sy
ay AR2
user-interface console 0
idle-timeout 0
q
int g0/0/0
ip add 100.1.1.2 29
int g0/0/1
ip add 200.1.1.254 24

```


## Easy-ip
#### ![拓补图](https://raw.githubusercontent.com/swdxiaoxiao/imgs/main/小书匠/1701411937538.png)
#### AR1
```
u t m 
sy
sy AR1
user-interface console 0
idle-timeout 0
q
int g0/0/0
ip add 192.168.1.254 24
int g0/0/1
ip add 100.1.1.1 30
quit
1)配置acl定义需要访问互联网的内网地址段
acl 2000
rule 10 permit source 192.168.1.0 0.0.0.255
quit
2)在出接口上配置easy-ip :利用出接口IP地址来做nat转换
int g0/0/1
nat outbound 2000
3)配置默认路由
ip route-static 0.0.0.0 0.0.0.0 100.1.1.2

```
#### AR2
```

u t m 
sy
sy ISP-DX
user-interface console 0
idle-timeout 0
q
//ISP 设备的接口IP地址，掩码改为30
int g0/0/0
ip add 100.1.1.2 30
int g0/0/1
ip add 200.1.1.254 24
quit
ip rou 0.0.0.0 0 100.1.1.1

```

## 端口映射
#### 拓扑图
![拓扑图](https://raw.githubusercontent.com/swdxiaoxiao/imgs/main/小书匠/1701414634866.png)
#### 配置思路
![配置步骤](https://raw.githubusercontent.com/swdxiaoxiao/imgs/main/小书匠/1701414668599.png)
#### 实验要求
![实验要求](https://raw.githubusercontent.com/swdxiaoxiao/imgs/main/小书匠/1701414702452.png)
#### AR1
```
u t m 
sy
sy AR1
user-interface console 0
idle-timeout 0
q
int g0/0/0
ip add 192.168.1.254 24
int g0/0/1
ip add 100.1.1.1 29
quit
1)配置acl定义需要访问互联网的内网地址段
acl 2000
rule 10 permit source 192.168.1.0 0.0.0.255
quit
2)在出接口上配置easy-ip :利用出接口IP地址来做nat转换
int g0/0/1
nat outbound 2000
quit
3)配置默认路由
ip route-static 0.0.0.0 0.0.0.0 100.1.1.2
int g0/0/1
nat server protocol tcp global 100.1.1.6 80 inside 192.168.1.50 80
//将私有IP: 192. 168.1.50的80端口映射给公有:IP: 100.1.1. 6的80的端口
//让外网主机能够通过100.1.1.6:80访问到企业内网web服务器

```
#### AR2
```
u t m 
sy
sy ISP-DX
user-interface console 0
idle-timeout 0
q
int g0/0/0
ip add 100.1.1.2 29
int g0/0/1
ip add 200.1.1.254 24
quit
ip rou 0.0.0.0 0 100.1.1.1

```
