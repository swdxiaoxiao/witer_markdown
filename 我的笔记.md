[笔记链接](http://8.141.81.195/NTD/)
# SWITCHING
## DAY01
### 一、传输层
#### 1、传输协议
　1）. TCP 协议:传输控制协议，面向连接、可靠、效率低<br>
　２）. UDP协议：用户数据包协议，无连接、不可靠、效率高<br>
#### 2、TCP三次握手
　seq(序列号)，	ack(确认号)　<br>
　SYN(标志位),	 ACK(标志位)<br>
　　　　　主机A　　　　　　　　　　　　　主机B<br>
第一次：  　 seq号=100，SYN位=1  请求连接<br>
第二次：　　　　　　　　　　　　　　　　　回应seq号=300，ack号=101<br>
　　　　　　　　　　　　　　　　　　　　　发起连接  SYN位=1，ACK位=1<br>
第三次： 　　seq号=101，ack号=301，ACK位=1<br>
#### 3、TCP的四次挥手
　ACK(标志位 0/1)，FIN(标志位 0/1) <br>
　　　　　　　　　主机A                                　　　 主机B<br>
第一次： 　　　FIN位=1，ACK位=1<br>
第二次：　　　　　　　　　　　　　　　　　　ACK位=1<br>
第三次：																 FIN位=1，ACK位=1<br>
第四次： 　　　　　ACK=1<br>

#### 4、UDP封装![封装格式](https://raw.githubusercontent.com/swdxiaoxiao/imgs/main/小书匠/UDP帧格式.png)
1)源端口：源端口和IP地址的作用是标识报文的返回地址<br>
2)目的端口：目标端口指明接收方计算机上的应用程序接口<br>
3)UDP长度：代表整个UDP的数据报是多大<br>
4)UDP校验和：是一个检查机制，在发送数据包之前检查一下数据包的完整性<br>
### 二、应用层
#### 1、DNS
1)DNS：域名解析系统，端口TCP或UDP的23
2) ==域名注册网站 #EE3F4D==
- 新网 www.xinnet.com
- 万网-阿里云 www.net.cn
- 中国互联 hulian.top
#### 2、FTP
1)FTP概述<br>
- 文件传输协议
- 控制连接: TCP 21
- 数据连接: TCP 20
 2)数据连接的建立类型:<br>
　主动模式:服务器主动发起数据连接(当客户端需要建立连接时,它会向服务器发送port命令,告知服务已打开了某个端口,接下来服务器通过 20 端口主动和客户端已打开的端口建立数据连接)<br>
　被动模式：客户端主动发起数据连接，服务器被动等待(当客户端需要建立数据连接时，它会向服务器发送PASV命令，告知服务器使用被动模式进行数据传输，服务器会打开一端口等待客户端来连接<br>
#### Telnet
1)telnet概述<br>
- 远程终端协议<br>
- 端口号：TCP23<br>
 2）telnet常见认证：<br>
 密码认证（仅需要密码）<br>
 AAA 认证（需要用户名和密码，可以为不同用户配置不同权限）<br>
##### Telnet -AAA 认证实验<br>
 R1 通过telnet协议远程控制R2<br>
### 三、冲突域<br>
#### 1.什么是冲突域<br>
 1）在一个网络范围内发送数据时会产生冲突的区域就是冲突域<br>
 2）冲突域是以太网致命故障，导致信号冲突，数据损坏、丢失、 数据传输慢<br>
#### 2.接口模式：
 - 单工模式：
   传输数据的信道只有一个，只能接收数据，不能回复数据（类似BB机）
- 半双工模式：
  传输数据的信道只有一个，可以接收数据，也可以回复数据，但是不能同时进行（类似：对讲机）
- 全双工模式：
- 传输数据的信道有两个人，接口可以在同一时刻接收和发送数据；（类似：电话 ） 通过设备来分割通过什么设备来分割冲突域：交换机<br>
<br>
==*交换机的每一个接口都是一个独立的冲突域，有专门的数据信道来为用户转发数据；<br>* #EE3F4D==
==*而且交换机的每个接口默认都是全双工模式；* #EE3F4D==<br>
### 四、以太交换网络
#### 1、什么是交换机
1）把多台电脑连接在一起的设备， 组建局域网的主要设备
2）分割冲突域，实现全双工
#### 2、交换机工作原理
交换机工作过程：
1）学习：学习数据帧源地址MAC地址，生MAC地址表，并将源MAC地址和对应的接口号写入MAC地址表<br>
2）广播：向除源接口之外的所有接口广播未知目标MAC地址<br>
3）转发：根据MAC地址表转发数据帧<br>
4）更新：端口对应主机MAC地址发生变化重新学习<br>
　　　　MAC地址表中记录生存时间为==300秒 #EE3F4D==
#### 3、查看MAC地址表
> 显示MAC地址表：<br>
*display mac-address*

### 五、广播域
#### 1、什么是广播域
1）能够接收到同样广播消息的集合<br>
2）当同一广播域内广播报文过多时，会对局域网造成干扰，导致网络延迟，网络堵塞（上网卡，上网慢），严重情况可以造成广播风暴，导致网络瘫痪，给网络的安全寻个带来了严重挑战。<br>
#### 2、如何解决广播风暴
1）利用路由器分割广播域：路由器的每一个接口都是一个独立的广播域<br>
2）利用vlan技术分割广播域<br>
备注：<br>
1）交换机的每一个接口都是一个独立冲突域，所以交换机可以完美的分割冲突域
2）交换机的所有接口都属于一个广播域，所以交换机默认情况下无法分割广播域
3）路由器的每一个接口都是一个广播域，所以路由器可以分割广播域
4）但在企业内部局域网，交换设备更多，所以需要在交换机中分割广播域，利用vlan技术可用在交换机中分割广播域，实现广播报文的隔离。
### 六、VLAN
#### 1、为什么会有VLAN
1）交换机只能分割冲突域但是不能分割广播域
2）随着交换机接口的数量的增多，网络中广播增多，会降低网络的传输效率，可以是用VLAN技术分割这个大的广播域
#### 2、什么是VLAN？
Virtual LAN（虚拟局域网）<br>
主要作用：分割广播域
#### 3、vlan的基本配置
1）创建vlan
>vlan 2 [2-4094] 创建vlan<br>
vlan batch 10 20 30 创建多个不连续的vlan<br>
display vlan 查看vlan信息<br>
vlan batch 50 to 60创建多个连续的vlan<br>
vlan2<br>
description caiwu添加描述信息（可选）<br>

2）删除vlan
>undo vlan 2 删除1个vlan<br>
undo vlan batch 10 20 30 删除多个不连续vlan<br>
undo vlan batch 50 to 60 删除多个连续vlan

3）添加vlan描述信息
>interface vlan 2 进入vlan2接口<br>
description caiwu（添加vlan描述信息caiwu，此配置可选）<br>
display this 查看当前有效配置

4)端口加入vlan
>interface GigabitEthernet0/0/1<br>
port link-type access<br>
port default vlan 2

## DAY02

### 一、vlan

#### 1.将多个端口加入vlan

> port-group x　　　　创建端口组x<br>
> group-member 端口1 to 端口2　　　将[端口1]到[端口2]添加至端口组[x]

#### 2.如何区分不同的VLAN数据？

1）要使交换机能够区分不同的VLAN的数据帧，需要在帧中添加标识VLAN信息的字段
2）IEEE 802.1Q 协议规定：在以太网数据帧的源MAC地址字段之后，协议类型字段之前加入4个字节的VLAN标签（又称VLAN　Tag，简称Tag），用以标识vlan信息
3）VLAN数据帧：目的地址+源地址+【Vlan-Tag】+类型+数据+帧校验序列
> - Vlan-Tag：共4个字节，分为4个字段，只需要记住最后一个字段 **==VID #EE3F4D==** 即可<br>
> - VID:可以理解为VLAN编号<br>
> 　　　　　　　是vlan-tag中的第四个字段,大小12个bit<br>
> - 2^12^ 是4096,所以可以创建(0-4095)个vlan,但是0和4095是被保留了<br>所以一个交换机中可以创建的vlan编号范围是 1-4094<br>

#### 3、PVID：

- PVID：port default vlan id ,又称缺省VLAN，表示接口所属的VLAN
- 每一个接口都有一个PVID
- 默认情况下，交换机所有的接口的PVID都是1

#### 4、在一个VLAN交换网络中，以太网分类：
> 有标记帧（Tagged帧）：加入4字节VLAN标签的帧<br><br>
> 目标地址+源地址+【Vlan-Tag】+类型+数据+帧校验序列<br><br><br>
无标记帧（Untagged帧）：原始的、没有加入4字节VLAN标签的帧<br><br>
目标地址+源地址+类型+数据+帧校验序列<br><br>

常用设备中：
- 用户交换机、服务器只能收发Untagged帧
- 交换机、路由器既能收发Tagged帧、也能收发Untapped帧

#### 5、Access接口模式：
工作场景：通常用于交换机连接终端设备（主机、、服务器）
特点：
- 同时只能属于一个vlan
- 当交换机接收数据帧时，若该帧不带vlan标签，用接口PVID的数值作为标签，给数据帧打标签
- 接收数据帧时，若带vlan标签，判断vlan标签和本接口的PVID是否一致，一致则接收数据，不一致则丢弃数据
- 发送标签时，一律剥离vlan标签
__命令:__
>进入接口视图<br>
>interface GigabitEthernet(g接口)/Ethernet(e接口)  0/0/0<br>
>修改接口连接模式为access<br>
>port link-type access<br>
>将接口加入vlan x [1<x<4094]<br>
>port default vlan x<br>
>>简写：<br>
>>int g0/0/0<br>
>>p l a<br>
>>p d v x<br>
#### 6、Trunk：
工作场景：通常用于交换机与交换机互连
特点：
- 同时可以属于多个vlan，同一时间可以传递多个vlan数据流
- 接收数据帧时，若该帧不带vlan标签，用接口PVID的数值作为标签，给数据帧打标签。然后判断是否允许这个vlan标签通过，如果允许，则接收数据，如果不允许则丢弃数据
- 接收数据帧时，若该帧带VL AN标签，判断是否允许这个vlan标签通过,如果允许则接收数据，如过不允许则丢弃数据
 -trunk发送数据帧时，一般不剥离 vlan标签,通常都是携带vlan标签通过.但是有一个例外，就是当数据帧的vlan标签,和这个trunk接口的pvid相同时，会剥离vlan标签
__命令：__
>进入接口视图<br>
>interface GigabitEthernet(g接口)/Ethernet(e接口)  0/0/0<br>
>修改接口连接模式为trunk<br>
>port link-type trunk<br>
>将接口加入vlan x，y [1<x,y<4094] (可以多个，为all时加入全部)<br>
>①port trunk allow-pass vlan x y<br>
>②port trunk allow-pass vlan x to y<br>
>>简写：<br>
>>int g0/0/0<br>
>>p l t<br>
>>p t a v x y<br>
>>p t a v x to y<br>
>>p t a v a　　==//加入所有 #929292==<br>

#### 7、Hybrid
工作场景：既可以连接用户终端，也可以连接交换机/路由器
特点：
可以像access接口一样，发送出去的数据帧不携带标签
可以像trunk接口一样，发送出去的数据帧携带标签
可以灵活控制接口上发送的数据帧是否携带标签
__命令：__
>**进入接口g0/0/1**<br>
]interface g0/0/1    <br>
**接口模式改为hybrid** <br>
port link-type hybrid<br>
**接口的pvid 改为50** <br>
port hybrid pvid vlan 50    <br>
①**接口发送数据帧时，允许vlan5 和10携带标签通过** <br>
port hybrid tagged vlan 5 10<br>
②**接口发送数据帧时，允许vlan5 和10通过，但是会剥离标签**<br>
port hybrid untagged vlan 5 10 <br>

### 二、STP-生成树协议

#### 1、为什么需要STP协议
1）局域网中容易出现问题：单点故障和单链路故障，即：当某一条链路故障或某一台设备故障导致大面积主机网络中断
2）如何预防单点故障和单链路故障：
==增加冗余/备份设备 #EE3F4D==：==预防单点故障 #619AC3==
==增加冗余/备份链路 #EE3F4D==：==预防单链路故障 #619AC3==
3）增加冗余/备份链路后，引发的新的问题：
交换机与交换机之间增加备份链路后：==极有可能形成环状网络，形成二层环路 #EE3F4D==
二层环路：==极有可能引发广播风暴 #EE3F4D==
广播风暴一旦形成：==会造成网络堵塞，设备宕机，网络不可用 #EE3F4D==
4）如何解决因二层环路导致的广播风暴？
STP 协议可以解决二层环路：STP会形成一个物理有环，逻辑无环的网络


#### 2、STP协议
1）stp是什么？
STP：Spanning Tree Protocol 生成树协议
2）STP的作用（如何实现逻辑无环，如何让防止广播风暴）
　所有交换机物理相互连接
 　所有交换机启动后，都运行生成树协议
 　通过生成树协议，逻辑上断开某个端口，从而形成一个逻辑无环拓扑，==避免广播风暴。 #EE3F4D==
  当链路出现问题，被禁用的链路可以重新启动，从而形成逻辑无环拓朴，起到了==链路备份 #EE3F4D==的作用

#### 3、STP的工作原理
步骤1：选举根交换机
步骤2：在每个非根交换机上选举一个根端口
步骤3：在每条链路（每个网段）上选举一个指定端口
步骤4：==阻塞备用端口 #EE3F4D==（Alternate Port AP），阻塞非指定端口

#### 4、选举跟交换机
选网桥ID最小的交换机为根网桥
网桥ID= 网桥优先级+网桥的MAC地址
网桥ID由8个字节组成其中网桥优先级2个字节，网桥MAC是6个字节
网桥优先级：范围0-65535（理论取值范围），实际取值范围0-61440.默认32768，步长4096

#### 5、选举根端口
1）非根交换机中有且只有一个根端口
2）选举根端口原则：
非根交换机的根路径开销值（根路径成本）最小的端口，即端口( ==此端口到根的路径成本之和最低 #EE3F4D==)
如果根路径开销值相同，则比较端交换机的BID，越小越优先（==此端口直连网桥ID最小 #EE3F4D==）
如果对端BID也相同，则比较PID，越小越优先，
**注：路径开销（路径成本）：Cost**
路径开销可以形容交换机之间的“距离远近”，开销值越来越优先
交换机的每一个端口都有一个路径开销-cost值
交换机的接口cost值和端口带宽有关系，带宽越高，cost值越小
默认情况下，华为交换机千兆端口的cost值为：20000
默认情况下，华为交换机百兆端口的cost值为：200000
10Mbit.s 2000000
1000Mbit/s 200000
1Gbit/s 20000
10Gbit/s 2000
**注：PID（端口值ID）：**
端口优先级+端口号组成==（值越小越优先） #EE3F4D==

#### 6、选举指定接口
1）在每一条链路上选择一个指定端口
根交换机中的接口全是指定端口
2）选举指定端口原则：
一条链路上，到根交换机的根路径开销值最小的端口，即指定端口
如果根路径开销值相同，则比较==接口所在交换机 BID #EE3F4D==，越小越优先
如果交换机的BID也相同，则比较PID，越小越优先

#### 7、STP基础命令
>display stp<br>
==//显示交换机的stp详细信息 #929292==<br>
stp mode stp<br>
==//工作模式改为STP（华为交换机默认开机运行的是MSTP） #929292==<br>
stp priority 4096<br>
==//设置交换机的STP优先级为4096 #929292==<br>

## DAY03

### 一、STP端口状态和STP计时器

#### 1、BPDU报文
1）BPDU：桥协议数据单元
作用：交换机之间通过周期性发送BPDU报文，来实现STP功能
2）BPDU的四个重要字段：
根网桥ID：跟交换机的BID
根路径开销：本端口累计到根网桥的开销值（cost值）
发送网桥ID：本交换机的BID
端口ID：发送该BPDU报文的端口的ID
3）BPDU类型
配置BPDU和拓扑变更BPDU。

#### 2、STP的端口５种状态
禁用（disabled）：强制关闭，没有启动STP协议
阻塞（blocking）：只接收BPDU报文，不发送BPDU报文
侦听（listening）：比较BPDU报文，确定交换机角色和端口角色
学习（learning）：基于端口上收到的数据帧，学习MAC地址表
转发（forwarding）：端口最终的状态，能够发送和接收用户数据

#### ３、STP３种的计时器
hello时间：端口发送的BPDU报文的时间间隔：默认是２秒
转发延迟（forward　delay）：侦听——学习：15秒、学习——转发：15秒
最大老化时间（Max Age）：一个端口最大的”没有接收BPDU“的时间间隔：20秒

#### 4、STP的最大收敛时间：30~50秒
1）根交换机故障，STP的收敛时间约为50秒
2）链路故障：SYP的收敛时间约为30~50秒





# 大中型园区网络
## day01
### 一、浮动路由
#### 1、浮动路由概述
1）浮动路由是什么？
- 浮动路由又称为路由备份，由两条或多条链路组成浮动路由
- 浮动路由指配置两条静态路由，这两条静态路由的目的地址相同，但是下一跳地址不同两条静态路由
- 给这两条静态路由设置不同的优先级，优先级高的那条静态路由做为主链路，优先级低的那条静态路由做为备份链路 。
- 当主链路出现故障的时候，备份链路进入路由表中，顶替主链路承担数据转发任务
- 当主链路故障恢复的时候，主链路进入路由表，承担数据转发任务，备份链路变为不可用状态移出路由表

2）浮动路由的作用：预防单链路故障，保持网络的不中断
3）浮动路由特点：浮动路由在同一时刻，数据只会由一条链路进行转发<br>
#### 2、路由的优先级
1）当去往同一个目的地有多条路由时，为了判断最优路由，各路由协议（包括静态路由）都被赋予了一个优先级
2）优先级高的（数值小）的路由会成为最优路由，路由器会将最优路由条目放入本地路由表中。
3）路由优先级：优先级用数值表示，数值越小优先级越高
|                    |     |
| ------------------ | --- |
| Direct： 直连路由  |   0   |
| Static：  静态路由 |   60  |
备注：配置完浮动路由后，只有主链路那条路由会出现在路由表中，备份链路那条路由不会出现在路由表，当主链路故障时，备份链路那条路由才会进入路由表

#### 3、浮动路由实验
1）拓扑
![enter description here](https://raw.githubusercontent.com/swdxiaoxiao/imgs/main/小书匠/命令草稿-浮动路由实验.png)

2）需求：
> 配置浮动路由，实现链路冗余（让192.168.2.0/24那条链路成为主链路）

3）配置步骤: 
>第一步：配置PC的IP地址，掩码，网关<br>
第二步：交换机配置VLAN，接口加入指定的VLAN<br>
1）SW1交换机创建VLAN  10<br>
2）SW1交换机的所有接口都设置为Access模式，并加入指定的VLAN  10<br>
3）SW2交换机创建VLAN  40<br>
4）SW2交换机的所有接口都设置为Access模式，并加入指定的VLAN  40<br>

第三步：路由器配置接口IP地址<br>

第四步：路由器配置浮动路由
>1）配置一条静态路由为主链路，静态路由默认优先级为60<br>
2）配置一条静态路由为备份链路，指定路由优先级为70<br>

第五步：验证与测试
>1）验证是否主链路转发数据<br>
2）验证是否主链路那条路由进入路由表<br>
3）让主链路出现故障，验证备份链路是否起作用<br>

4）配置命令
第一步：配置PC的IP地址，掩码，网关 
第二步：交换机配置VLAN，接口加入指定的VLAN 
>1）SW1交换机创建VLAN  10<br>
2）SW1交换机的所有接口都设置为Access模式，并加入指定的VLAN  10<br>
3）SW2交换机创建VLAN  40<br>
4）SW2交换机的所有接口都设置为Access模式，并加入指定的VLAN  40<br>

SW1配置： 
>vlan 10<br>
>quit<br>
>port-group group-memb  <br>
>port-group group-member g0/0/1 to g0/0/3<br>
>port link-type access<br>
>port default vlan 10<br>

 SW2配置：
>vlan 40<br>
>quit<br>
>port-group group-member g0/0/1 g0/0/2<br>
>port link-type access<br>
.port default vlan 40<br>


 第三步：路由器配置接口IP地址 
 R1配置： 
>int g0/0/0<br>
>ip address  192.168.1.254 24<br>
>int g0/0/1<br>
>ip address  192.168.2.1   24<br>
>int g0/0/2<br>
>ip address  192.168.3.1   24<br>

 R2配置：
>int g0/0/0<br>
>ip address  192.168.4.254 24<br>
>int g0/0/1<br>
>ip address  192.168.2.2   24<br>
>int g0/0/2<br>
ip address  192.168.3.2   24<br>

 第四步：路由器配置浮动路由 
>1）配置一条静态路由为主链路，静态路由默认优先级为60<br>
>2）配置一条静态路由为备份链路，指定路由优先级为70<br>

 R1配置： 
>ip route-static 192.168.4.0  24  192.168.2.2   //配置静态路由<br>
>ip route-static 192.168.4.0  24  192.168.3.2  preference  70   //配置静态路由并指定优先级<br>

 R2配置：
>//配置静态路由<br>
>ip route-static 192.168.1.0  24  192.168.2.1<br>
>//配置静态路由并指定优先级<br>
>ip route-static 192.168.1.0  24  192.168.3.1  preference  70<br>

 第五步：验证与测试 
>1）验证是否主链路转发数据<br>
>2）验证是否主链路那条路由进入路由表<br>
>3）让主链路出现故障，验证备份链路是否起作用<br>
>PC1------>tracert 192.168.4.3   使用路由追踪或数据抓包验证<br>
>display ip routing-table   //查看进入路由表的最优路由<br>
> display  ip routing-table  192.168.4.3<br>

查看静态路由 
 > display ip routing-table protocol static

Static routing table status :  ＜Active＞-活跃 
|Destination/Mask |   Proto  | Pre  |  Cost    | NextHop       |  Interface|
|----|----|-----|----|----|----|
|192.168.4.0/24    |  Static|   60  |   0        |  192.168.2.2    |  GigabitEthernet0/0/1|
Static routing table status : ＜ Inactive＞-不活跃的-停用的 
|Destination/Mask  |  Proto  | Pre  |Cost  |   NextHop   |      Interface|
|----|----|-----|----|----|----|
|192.168.4.0/24   |   Static  | 70  |  0      |   192.168.3.2     | GigabitEthernet0/0/2|
 备注：shutdown 掉R1的g0/0/1 让主链路故障，验证备份链路是否会进入路由表，承担数据转发任务
 ## 二、VRRP
#### 1、VRRP概述
1）VRRP 是什么
-VRRP：虚拟路由器冗余协议
-通过把几台路由设备联合组成一台虚拟的路由设备，将虚拟路由设备的IP地址作为用户的默认网关实现与外部网络通信。
-当网关设备发生故障时，VRRP能够选举新的网关设备承担数据流量，从而保障网络的可靠性，保障网络不中断。
2）VRRP的作用：
- 实现多个真实网关的冗余备份
- 实现数据转发的负载均衡

3）VRRP组成员角色
- 主路由器：Master  →负责承担数据报文转发任务
- 备份路由器：Backup →负责监控主路由器状态
- 虚拟路由器 ：Virtual → 又称VRRP备份组，虚拟路由器的IP地址作为局域网中主机的默认网关

4）VRRP主备角色选择原则
-首先比较优先级，优先级大的为master
-如果优先级一致，其次比较ip地址，IP地址大的为master （模拟器无法模拟）
> 总结：==越大越优先 #EE3F4D==

5）VRRP需知
- 在一个VRRP备份组中，Master设备有且仅有一个
- VRRP协议包括两个版本：VRRPv2和VRRPv3
- VRRPv2仅适用于IPv4网络，VRRPv3适用于IPv4和IPv6两种网络
- VRRP协议报文封装在IP报头的后面，协议号是112
- VRRP通告报文源地址为主路由器物理接口的IP地址（不是虚拟IP地址），目的地址是224.0.0.18
-VRRP协议号是112

#### 2、VRRP名词解释
1）VRRP路由器：凡是运行VRRP协议的路由器，都叫VRRP路由器
2）虚拟路由器：又称VRRP备份组
3）Master路由器：承担数据转发任务的路由器
4）Backup路由器：备份路由器
5）VRID：虚拟路由器的标识，又称备份组组号
6）虚拟IP地址：Virtual IP ：虚拟路由器的IP地址，即：局域网内主机的默认网关地址
7）虚拟MAC地址：：虚拟MAC地址根据虚拟路由器VRID生成的
      &：一个虚拟路由器拥有一个虚拟MAC地址
           如果VRID是1： 虚拟MAC地址就是： 00-00-5E-00-01-01
           如果VRID是5： 虚拟MAC地址就是： 00-00-5E-00-01-05
           如果VRID是233： 虚拟MAC地址就是： 00-00-5E-00-01-==E9 #EE3F4D== 
          (==10进制的233  等于 16进制的E9 #EE3F4D==)

#### 3、VRRP工作过程
1）VRRP备份组中的设备根据优先级选举出Master-主路由器
2）Master-主路由器发送免费ARP报文，将虚拟MAC地址通知给与它连接的设备，承担数据转发任务
3）Master-主路由器周期性发送VRRP通告报文（三层心跳报文）
4）通告报文发送的周期时间：默认情况下是1秒
5）通告报文发送的目的地址是组播地址：224.0.0.18
6）Backup-备份路由器监控主路由器状态，在3倍的"发送周期"后，如果无法收到主路由器发送的VRRP 通告报文，备份路由器升级为“新的Master-主路由器”，新的Master-路由器会立即发送免费ARP报文，刷新与它连接设备中的MAC表项，从而把用户流量引到新的Master设备上来。
7）原Master设备故障恢复时，首先切换至Backup状态：
　　&：如果原Master已开启抢占模式，并且对比优先级，发现自己的优先级高，则主动将自己切换成Master。
　　&：如果原Master没有开启抢占模式，即便优先级高，也不会进行抢占，依然保持Backup状态

#### 4、VRRP热备配置命令
> 1、入对应接口视图（交换机则为VLAN接口）<br>
> 2、vrrp vrid X virtual-ip X.X.X.X<br>
> //X为VRRP备份组号，X.X.X.X为虚拟路由IP（网关）<br>
> 3、vrrp vrid 1 priority 130<br>
> //130为优先级，默认为100（==越大越优先 #EE3F4D==）<br>

#### 5、VRRP上行链路跟踪（上行端口跟踪）配置命令
>vrrp vrid 1 track interface 真实接口 reduced  50 <br>
>==[真实接口] #000000==为被监测的接口，reduced为减少50优先级，当为increased时则增加50优先级<br>

#### 6、VRRP认证
1）VRRP认证方式
&无认证方式：VRRP通告报文不做认证（默认）
&Simple：简单字符认证方式：在网络中传输的时候，不加密，明文密码
&MD5认证方式：在网络中传输时，进行MD5加密
2）VRRP认证作用：提高VRRPP报文的安全性
3）VRRP认证特点：
当主路由器发送VRRP通告报文：受到VRRP通告报文的设备会对比认证方式和密码有一项不匹配，丢弃VRRP报文，VRRP备份组建立失败。
**4）配置认证命令**
>interface 接口<br>
>//进入接口视图（交换机为配置VRRP的VLAN接口）<br>
>vrrp vrid 1 authentication-mode 认证模式 密码 <br>

## DAY02

### 一、BFD

#### 1、BFD概述
1）**什么是BFD**
- Bidrectional Forwarding Detection：**双向转发检测**

2）**BFD技术背景**
现网中存在的问题：
- 不能快速有效的发现网络设备或链路出现的故障
- 不能以毫秒级的速度发现网络问题
- 协议自身的报文检测机制一般都大于1秒
  解决方案：
  - 需要一种专门用于快速检测设备或链路的协议：BFD协议产生

3）**BFD的作用**
- 专门用于发送超小和超快的的检测数据包，以毫秒级进行发送，快速检测链路的故障，改善网络性质
- 当发现链路故障时，通知相关的设备和协议进行处理，快速恢复通信，保证网络可靠性

4）**BFD的优点：**
- 对于任何介质、任何协议层进行实时且快速的检测

5）**BFD会话建立方式**
- BFD会话的建立有：*静态建立*、*动态建立*两种方式
- 静态建立BFD会话：手工配置BFD会话参数（手工配置：本地标识符和远端标识符）
- 动态建立BFD会话：动态分配本地标识符、自学远端标识符
- 静态和动态的主要区别：本地标识符和远端标识符配置方式不同

7）**BFD检测机制**
- 两个设备建立BFD会话，链路两端周期性发送BFD控制报文，如果一端在既定的时间内没有收到BFD控制报文，则认为路径上发生了故障。

8）**BFD会话常见参数的缺省配置**

| 参数         | 缺省值   |
| ------------ | -------- |
| 发送间隔     | 1000毫秒 |
| 接收间隔     | 1000毫秒 |
| 本地检测倍数 | 3        |

#### 2、配置命令

一：开启BFD
> bfd

二、配置BFD
> ==//创建BFD会话 #B78D12==<br>
> bfd ntd bind peer-ip ==[目标设备的] #929292==IP<br>
> ==//配置本地标识符x #B78D12==<br>
> discriminator local x<br>
> ==///配置远端 #B78D12== ==[目标设备] #929292====标识符y #B78D12==<br>
> diacriminator remote y<br>
> ==//接受报文间隔时间100毫秒 #B78D12==<br>
> min-rx-interval 100
> ==//发送报文间隔时间100毫秒 #B78D12==<br>
> min-tx-interval 100
> ==//提交 #B78D12==<br><br>
> commit<br>
>==//查看bfd会话 #B78D12==
display bfd session all  

查询结果
--------------------------------------------------------------------------------.
Local Remote     PeerIpAddr      State     Type        InterfaceName       
--------------------------------------------------------------------------------.
1     3          192.168.23.3    Up        S_IP_PEER         -             
--------------------------------------------------------------------------------.
Total UP/DOWN Session Number : 1/0
     
字段解析：
local :本地标识符
remote : 远端标识符
PeerIPaddr : 对端IP地址
state : 状态
type : 类型    S_IP_PEER  :S代表静态会话，IP_PEER :代表利用对端IP地址建立的静态会话 



#### 3、与VRRP链路追踪联合使用
**命令**
> vrrp vrid 组号 track  bfd-session 本地BFD标识符 increased  60

### 二、HDCP

#### 1、DHCP概述
1）DHCP是什么
- **DHCP**：Dynamic Host Configuration Protocol ：**动态主机配置协议**
- DHCP 是一种集中对用户IP地址进行动态管理和配置的技术

2）DHCP技术背景：
- 网络规模不断扩大，计算机和移动终端越来越多，都需要上网，都需要不断更新IP地址，所以安全高效的给这些终端主机分配IO地址就变得特别重要：
- 所以可以动态的为主机分配IP地址的技术出现-DHCP

 3）DHCP的作用
- 作用：实现IP地址的动态分配和集中管理
- 优势：避免手工配置IP地址，提高工作效率，避免出错，且能够快速适用网络的变化



# BACKBONE 骨干网络规划
## DAY01
### 一、BGP协议基础
#### 1、路由的分类
1）直连路由
2）非直连路由（间接路由）
　&：静态路由
　&：动态路由
@：IGP：内网网关路由协议（在企业内部或数据中心内部使用·）

　　==DV：距离矢量路由协议 #619AC3==
 - RIP(v1/v2)
 - IGP——网络直径：100—255（思科的私有协议）
 - EIGP—思科的私有协议

　　==LS：链路状态路由协议 #619AC3==
 - ISIS-中间系统到中间系统
 - OSPD—开放式最短路径优先
@：EGP:外部网关路由协议：在不同公司之间使用，在不同的城市之间
　BGP：边界网关协议（路径适量路由协议）
#### 2、为什么要使用BGP
我们要在不同AS之间实现网络通信，需要使用EGP-BGP协议，当然我们还看重BGP的一些优势
1）非常稳定
2）可以传输大量的路由，支持大规模网络
3）具有非常丰富的路由控制策略，可以灵活的选路
#### 3、BGP概述
- BGP:边界网关协议
- BGP是公有协议，任何厂商的设备都支持BGP
- BGP位于OSI第七层（应用层，TCP协议）
  备注：`OSPF基于IP协议，为了可靠性，数据库同步：协商主从关系，序列号、有确认机制`
  #### 4、AS号
- AS号（AUtonomous System Number）：自治系统
- 是互联网中的一种标识符，用于标识一个自治系统（AS)的唯一数字。自治系统是指由以组网络和路由器组成的网路。
- AS号是由互联网分配机构IANA(互联网分配号码管理局)分配。
- AS号的范围被划分为两类：公共AS号和私有AS号。
	- 公共AS号是指IANA分配的AS号，可用于在全球范围内标识自治系统。
	- 私有AS号是指互联网注册机构（IR）分配的AS号，用于在私有网络标识自治系统。
- AS通常使用”数字“来表示，称为AS号
- AS号的范围是从0到65535，其中0被保留不使用
- AS编号取值范围
&：之前——字节表示，取值范围：1-65535
　  #私有AS号：64512-65534，可以用于在私有互联网中标识自治系统。但不会在公共互联网中出现。这些AS号通常用于连接组织的内部网络。
&：目前是四个字节：1-4294967295
　4字节AS号范围是从0到4294967294
　私有AS号范围是00000000至4294967294
　4字节AS号由IANA管理，并由全球RR（区域互联网注册局）负责分配
在国内，中国的运营商通常将AS号按照不同的地理区域划分
AS号的划分方式取决于运营商的具体管理需求和网络架构，可以按照城市、区域、网络、子网等不同的维度进行划分。
截止2021年9月，中国共分配了超过37,000个AS号。要查询中国已分配的AS号，可以使用以下方法：
==`访问CNNIC官网：CNNIC是中国国家互联网信息中心` #B78D12==
### 二、BGP协议概述

####  1、场景
场景一：遍布全国大型政企单位之间，或大型数据中心
场景二：运营商骨干网

#### 2、作用
在AS之间动态的交互路由信息，实现公司与公司之间的互访

#### 3、优势
1）稳定，基于TCP协议建立的，使用端口号TCP179，所以非常稳定
2）传递大量路由，可以跨多跳建立邻居关系
3）路由控制策略丰富

#### 4、BGP邻居类型
==**ENGP** #EE3F4D==：运行与不的AS
==**IBGP** #EE3F4D==：运行与同一AS内部

#### 5、BGP的特征
- BGP使用传输层协议==TCP #B78D12==协议端口是==179 #B78D12==.路由器之间的BGP会话基于TCP连接而建立
- 运行BGP的路由被称为BGP发言者（BGP Speaker），或BGP路由器
- 两个建立BGP会话的路由器互为对等体（peer）==//邻居 #929292==
- BGP路由器只能发送增量BGP路由更新，或进行触发式更新（不会周期性更新）。
- BGP能传递大量的路由，可以在大规模网络中使用

#### 6、BGP报文类型
- open：用于建立邻居关系（类似hello报文）
- keep alive：用于维护邻居关系，周期性发送，保持BGP连接
- update：用于路由的传递和撤销
- notification：通知报文，用于通知邻居之间的报错信息，用于断开连接
- router-refresh：重传报文，请求邻居重新发送路由信息
 
| 报文名称      | 作用                                                                                            | 发送时刻                                                                                                 |
| ------------- | ----------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- |
| open          | 协商BGP对等体参数，建立对等体关系                                                               | BGP tcp连接建立成功之后                                                                                  |
| update        | 发送BGP路由更新                                                                                 | BGP邻居关系建立之后有路由需要发送或路由变化时，向邻居发送UPdate报文                                      |
| Notificatiin  | 报告错误信息，中止邻居关系                                                                      | 当BGP路由器在运行中发现错误，发送NOtification报文将错误信息通告给BGP邻居                                 |
| keepalive     | 标志邻居关系建立成功，维持邻居关系                                                              | 当BGP路由器收到对端发来的Keep alive报文，将邻居状态置为已建立，同时后续定期发送Keepalive报文用于保持连接 |
| Route-refresh | 用于在改变路由策略后请求对等体重新发送路由信息。只有支持路由刷新能力的BGP设备会发送和响应此报文 | 当路由策略发生变化时，触发请求对等体重新通告路由                                                         |

#### 7、BGP工作过程
![BGP工作过程](https://raw.githubusercontent.com/swdxiaoxiao/imgs/main/小书匠/BGP工作过程.png)

#### 8、BGP状态
1）idle:初始化状态
- tcp未连接状态，邻居的状态为idle，当BGP设备和邻居进行tcp连接时，会从当前的状态转为connect状态
2）connect状态：tcp连接状态
- 如果tcp建立成功，bgp设备会向邻居发送open报文，状态也会转为opensent状态
- 如果tcp建立连接失败，bgp设备状态会转为active状态
3）active状态：活跃状态
- 在当前状态下，bgp设备依然没有放弃希望，依然试图继续建立tcp连接，如果成功，状态依然可以转化为opensent状态
- 如果依然失败，BGP会停留在active状态
  


