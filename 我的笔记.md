# SWITCHING
## day01
### 一、传输层
#### 1、传输协议
　1）. TCP 协议:传输控制协议，面向连接、可靠、效率低<br>
　２）. UDP协议：用户数据包协议，无连接、不可靠、效率高<br>
#### 2、TCP三次握手
　seq(序列号)，	ack(确认号)　<br>
　SYN(标志位),	 ACK(标志位)<br>
　　　　　主机A　　　　　　　　　　　　　主机B<br>
第一次：  　 seq号=100，SYN位=1  请求连接<br>
第二次：　　　　　　　　　　　　　　　　　回应seq号=300，ack号=101<br>
　　　　　　　　　　　　　　　　　　　　　发起连接  SYN位=1，ACK位=1<br>
第三次： 　　seq号=101，ack号=301，ACK位=1<br>
#### 3、TCP的四次挥手
　ACK(标志位 0/1)，FIN(标志位 0/1) <br>
　　　　　　　　　主机A                                　　　 主机B<br>
第一次： 　　　FIN位=1，ACK位=1<br>
第二次：　　　　　　　　　　　　　　　　　　ACK位=1<br>
第三次：																 FIN位=1，ACK位=1<br>
第四次： 　　　　　ACK=1<br>

#### 4、UDP封装![封装格式](https://raw.githubusercontent.com/swdxiaoxiao/imgs/main/小书匠/UDP帧格式.png)
1)源端口：源端口和IP地址的作用是标识报文的返回地址<br>
2)目的端口：目标端口指明接收方计算机上的应用程序接口<br>
3)UDP长度：代表整个UDP的数据报是多大<br>
4)UDP校验和：是一个检查机制，在发送数据包之前检查一下数据包的完整性<br>
### 二、应用层
#### 1、DNS
1)DNS：域名解析系统，端口TCP或UDP的23
2)==域名注册网站 #EE3F4D==
- 新网 www.xinnet.com
- 万网-阿里云 www.net.cn
- 中国互联 hulian.top
#### 2、FTP
1)FTP概述<br>
- 文件传输协议
- 控制连接: TCP 21
- 数据连接: TCP 20
 2)数据连接的建立类型:<br>
　主动模式:服务器主动发起数据连接(当客户端需要建立连接时,它会向服务器发送port命令,告知服务已打开了某个端口,接下来服务器通过 20 端口主动和客户端已打开的端口建立数据连接)<br>
　被动模式：客户端主动发起数据连接，服务器被动等待(当客户端需要建立数据连接时，它会向服务器发送PASV命令，告知服务器使用被动模式进行数据传输，服务器会打开一端口等待客户端来连接<br>
#### Telnet
1)telnet概述<br>
- 远程终端协议<br>
- 端口号：TCP23<br>
 2）telnet常见认证：<br>
 密码认证（仅需要密码）<br>
 AAA 认证（需要用户名和密码，可以为不同用户配置不同权限）<br>
##### Telnet -AAA 认证实验<br>
 R1 通过telnet协议远程控制R2<br>
### 三、冲突域<br>
 #### 1.什么是冲突域<br>
 1）在一个网络范围内发送数据时会产生冲突的区域就是冲突域<br>
 2）冲突域是以太网致命故障，导致信号冲突，数据损坏、丢失、 数据传输慢<br>
 #### 接口模式：
 - 单工模式：
   传输数据的信道只有一个，只能接收数据，不能回复数据（类似BB机）
- 半双工模式：
  传输数据的信道只有一个，可以接收数据，也可以回复数据，但是不能同时进行（类似：对讲机）
- 全双工模式：
- 传输数据的信道有两个人，接口可以在同一时刻接收和发送数据；（类似：电话 ） 通过设备来分割通过什么设备来分割冲突域：交换机<br>
<br>
==*交换机的每一个接口都是一个独立的冲突域，有专门的数据信道来为用户转发数据；<br>* #EE3F4D==
==*而且交换机的每个接口默认都是全双工模式；* #EE3F4D==<br>
### 四、以太交换网络
#### 1、什么是交换机
1）把多台电脑连接在一起的设备， 组建局域网的主要设备
2）分割冲突域，实现全双工
#### 2、交换机工作原理
交换机工作过程：
1）学习：学习数据帧源地址MAC地址，生MAC地址表，并将源MAC地址和对应的接口号写入MAC地址表<br>
2）广播：向除源接口之外的所有接口广播未知目标MAC地址<br>
3）转发：根据MAC地址表转发数据帧<br>
4）更新：端口对应主机MAC地址发生变化重新学习<br>
　　　　MAC地址表中记录生存时间为==300秒 #EE3F4D==
#### 3、查看MAC地址表
> 显示MAC地址表：
*display mac-address*

## 五、广播域
#### 1、什么是广播域
1）能够接收到同样广播消息的集合<br>
2）当同一广播域内广播报文过多时，会对局域网造成干扰，导致网络延迟，网络堵塞（上网卡，上网慢），严重情况可以造成广播风暴，导致网络瘫痪，给网络的安全寻个带来了严重挑战。<br>
#### 2、如何解决广播风暴
1）利用路由器分割广播域：路由器的每一个接口都是一个独立的广播域<br>
2）利用vlan技术分割广播域<br>
备注：<br>
1）交换机的每一个接口都是一个独立冲突域，所以交换机可以完美的分割冲突域
2）交换机的所有接口都属于一个广播域，所以交换机默认情况下无法分割广播域
3）路由器的每一个接口都是一个广播域，所以路由器可以分割广播域
4）但在企业内部局域网，交换设备更多，所以需要在交换机中分割广播域，利用vlan技术可用在交换机中分割广播域，实现广播报文的隔离。
### 六、VLAN
#### 1、为什么会有VLAN
1）交换机只能分割冲突域但是不能分割广播域
2）随着交换机接口的数量的增多，网络中广播增多，会降低网络的传输效率，可以是用VLAN技术分割这个大的广播域
#### 2、什么是VLAN？
Virtual LAN（虚拟局域网）<br>
主要作用：分割广播域
#### 4、vlan的基本配置
1）创建vlan
>vlan 2 [2-4094] 创建vlan
vlan batch 10 20 30 创建多个不连续的vlan
display vlan 查看vlan信息
vlan batch 50 to 60创建多个连续的vlan
vlan2
description caiwu添加描述信息（可选）

2）删除vlan
>undo vlan 2 删除1个vlan
undo vlan batch 10 20 30 删除多个不连续vlan
undo vlan batch 50 to 60 删除多个连续vlan

3）添加vlan描述信息
>interface vlan 2 进入vlan2接口
description caiwu（添加vlan描述信息caiwu，此配置可选）
display this 查看当前有效配置

4)端口加入vlan
>interface GigabitEthernet0/0/1
port link-type access
port default vlan 2

## day02

### 一、vlan
1.将多个端口加入vlan
> port-group x　　　　创建端口组x
> group-member 端口1 to 端口2　　　将[端口1]到[端口2]添加至端口组[x]

2.如何区分不同的VLAN数据？
1）要使交换机能够区分不同的VLAN的数据帧，需要在帧中添加标识VLAN信息的字段
2）IEEE 802.1Q 协议规定：在以太网数据帧的源MAC地址字段之后，协议类型字段之前加入4个字节的VLAN标签（又称VLAN　Tag，简称Tag），用以标识vlan信息
3）VLAN数据帧：目的地址+源地址+【Vlan-Tag】+类型+数据+帧校验序列
> - Vlan-Tag：共4个字节，分为4个字段，只需要记住最后一个字段 **==VID #EE3F4D==** 即可
> - VID:可以理解为VLAN编号
> 　　　　　　　是vlan-tag中的第四个字段,大小12个bit
> - 2^12^ 是4096,所以可以创建(0-4095)个vlan,但是0和4095是被保留了<br>所以一个交换机中可以创建的vlan编号范围是 1-4094






# 大中型园区网络
## day01
## 一、浮动路由
#### 1、浮动路由概述
1）浮动路由是什么？
- 浮动路由又称为路由备份，由两条或多条链路组成浮动路由
- 浮动路由指配置两条静态路由，这两条静态路由的目的地址相同，但是下一跳地址不同两条静态路由
- 给这两条静态路由设置不同的优先级，优先级高的那条静态路由做为主链路，优先级低的那条静态路由做为备份链路 。
- 当主链路出现故障的时候，备份链路进入路由表中，顶替主链路承担数据转发任务
- 当主链路故障恢复的时候，主链路进入路由表，承担数据转发任务，备份链路变为不可用状态移出路由表

2）浮动路由的作用：预防单链路故障，保持网络的不中断
3）浮动路由特点：浮动路由在同一时刻，数据只会由一条链路进行转发<br>
#### 2、路由的优先级
1）当去往同一个目的地有多条路由时，为了判断最优路由，各路由协议（包括静态路由）都被赋予了一个优先级
2）优先级高的（数值小）的路由会成为最优路由，路由器会将最优路由条目放入本地路由表中。
3）路由优先级：优先级用数值表示，数值越小优先级越高
|                    |     |
| ------------------ | --- |
| Direct： 直连路由  |   0   |
| Static：  静态路由 |   60  |
备注：配置完浮动路由后，只有主链路那条路由会出现在路由表中，备份链路那条路由不会出现在路由表，当主链路故障时，备份链路那条路由才会进入路由表

#### 3、浮动路由实验
1）拓扑![enter description here](https://raw.githubusercontent.com/swdxiaoxiao/imgs/main/小书匠/1701761434179.png)

2）需求：
> 配置浮动路由，实现链路冗余（让192.168.2.0/24那条链路成为主链路）

3）配置步骤: 
>第一步：配置PC的IP地址，掩码，网关
第二步：交换机配置VLAN，接口加入指定的VLAN
1）SW1交换机创建VLAN  10
2）SW1交换机的所有接口都设置为Access模式，并加入指定的VLAN  10
3）SW2交换机创建VLAN  40
4）SW2交换机的所有接口都设置为Access模式，并加入指定的VLAN  40
第三步：路由器配置接口IP地址

第四步：路由器配置浮动路由
>1）配置一条静态路由为主链路，静态路由默认优先级为60
2）配置一条静态路由为备份链路，指定路由优先级为70

第五步：验证与测试
>1）验证是否主链路转发数据
2）验证是否主链路那条路由进入路由表
3）让主链路出现故障，验证备份链路是否起作用

4）配置命令
第一步：配置PC的IP地址，掩码，网关 
第二步：交换机配置VLAN，接口加入指定的VLAN 
>1）SW1交换机创建VLAN  10
2）SW1交换机的所有接口都设置为Access模式，并加入指定的VLAN  10
3）SW2交换机创建VLAN  40
4）SW2交换机的所有接口都设置为Access模式，并加入指定的VLAN  40

SW1配置： 
~~~md
vlan 10
quit
port-group group-memb  
port-group group-member g0/0/1 to g0/0/3
port link-type access
port default vlan 10
~~~
 SW2配置：
~~~md
vlan 40
quit
port-group group-member g0/0/1 g0/0/2
port link-type access
port default vlan 40
~~~

 第三步：路由器配置接口IP地址 
 R1配置： 
```md 
int g0/0/0
ip address  192.168.1.254 24
int g0/0/1
ip address  192.168.2.1   24
int g0/0/2
ip address  192.168.3.1   24
```
 R2配置：
```md
int g0/0/0
ip address  192.168.4.254 24
int g0/0/1
ip address  192.168.2.2   24
int g0/0/2
ip address  192.168.3.2   24
```
 第四步：路由器配置浮动路由 
>1）配置一条静态路由为主链路，静态路由默认优先级为60
2）配置一条静态路由为备份链路，指定路由优先级为70

 R1配置： 
```md
ip route-static 192.168.4.0  24  192.168.2.2   //配置静态路由
ip route-static 192.168.4.0  24  192.168.3.2  preference  70   //配置静态路由并指定优先级
```
 R2配置：
```md
ip route-static 192.168.1.0  24  192.168.2.1   //配置静态路由
ip route-static 192.168.1.0  24  192.168.3.1  preference  70   //配置静态路由并指定优先级
```
 第五步：验证与测试 
>1）验证是否主链路转发数据
2）验证是否主链路那条路由进入路由表
3）让主链路出现故障，验证备份链路是否起作用
PC1------>tracert 192.168.4.3   使用路由追踪或数据抓包验证
display ip routing-table   //查看进入路由表的最优路由
 display  ip routing-table  192.168.4.3

查看静态路由 
 > display ip routing-table protocol static
Static routing table status :  ＜Active＞-活跃 
|Destination/Mask |   Proto  | Pre  |  Cost    | NextHop       |  Interface|
|----|----|-----|----|----|----|
|192.168.4.0/24    |  Static|   60  |   0        |  192.168.2.2    |  GigabitEthernet0/0/1|
Static routing table status : ＜ Inactive＞-不活跃的-停用的 
|Destination/Mask  |  Proto  | Pre  |Cost  |   NextHop   |      Interface|
|----|----|-----|----|----|----|
|192.168.4.0/24   |   Static  | 70  |  0      |   192.168.3.2     | GigabitEthernet0/0/2|
 备注：shutdown 掉R1的g0/0/1 让主链路故障，验证备份链路是否会进入路由表，承担数据转发任务
 ## 二、VRRP
#### 1、VRRP概述
1）VRRP 是什么
-VRRP：虚拟路由器冗余协议
-通过把几台路由设备联合组成一台虚拟的路由设备，将虚拟路由设备的IP地址作为用户的默认网关实现与外部网络通信。
-当网关设备发生故障时，VRRP能够选举新的网关设备承担数据流量，从而保障网络的可靠性，保障网络不中断。
2）VRRP的作用：
-实现多个真实网关的冗余备份
-实现数据转发的负载均衡

3）VRRP组成员角色
-主路由器：Master  →负责承担数据报文转发任务
-备份路由器：Backup →负责监控主路由器状态
-虚拟路由器 ：Virtual → 又称VRRP备份组，虚拟路由器的IP地址作为局域网中主机的默认网关

4）VRRP主备角色选择原则
-首先比较优先级，优先级大的为master
-如果优先级一致，其次比较ip地址，IP地址大的为master （模拟器无法模拟）

5）VRRP需知
-在一个VRRP备份组中，Master设备有且仅有一个
-VRRP协议包括两个版本：VRRPv2和VRRPv3
-VRRPv2仅适用于IPv4网络，VRRPv3适用于IPv4和IPv6两种网络
-VRRP协议报文封装在IP报头的后面，协议号是112
-VRRP通告报文源地址为主路由器物理接口的IP地址（不是虚拟IP地址），目的地址是224.0.0.18
-VRRP协议号是112

#### 2、VRRP名词解释
1）VRRP路由器：凡是运行VRRP协议的路由器，都叫VRRP路由器
2）虚拟路由器：又称VRRP备份组
3）Master路由器：承担数据转发任务的路由器
4）Backup路由器：备份路由器
5）VRID：虚拟路由器的标识，又称备份组组号
6）虚拟IP地址：Virtual IP ：虚拟路由器的IP地址，即：局域网内主机的默认网关地址
7）虚拟MAC地址：：虚拟MAC地址根据虚拟路由器VRID生成的
      &：一个虚拟路由器拥有一个虚拟MAC地址
           如果VRID是1： 虚拟MAC地址就是： 00-00-5E-00-01-01
           如果VRID是5： 虚拟MAC地址就是： 00-00-5E-00-01-05
           如果VRID是233： 虚拟MAC地址就是： 00-00-5E-00-01-==E9 #EE3F4D== 
          (==10进制的233 == 16进制的E9 #EE3F4D==)

#### 3、VRRP工作过程
1）VRRP备份组中的设备根据优先级选举出Master-主路由器
2）Master-主路由器发送免费ARP报文，将虚拟MAC地址通知给与它连接的设备，承担数据转发任务
3）Master-主路由器周期性发送VRRP通告报文（三层心跳报文）
4）通告报文发送的周期时间：默认情况下是1秒
5）通告报文发送的目的地址是组播地址：224.0.0.18
6）Backup-备份路由器监控主路由器状态，在3倍的"发送周期"后，如果无法收到主路由器发送的VRRP 通告报文，备份路由器升级为“新的Master-主路由器”，新的Master-路由器会立即发送免费ARP报文，刷新与它连接设备中的MAC表项，从而把用户流量引到新的Master设备上来。
7）原Master设备故障恢复时，首先切换至Backup状态：
      &：如果原Master已开启抢占模式，并且对比优先级，发现自己的优先级高，则主动将自己切换成Master。
      &：如果原Master没有开启抢占模式，即便优先级高，也不会进行抢占，依然保持Backup状态

