176.46.60.20

vlanif的作用？
	三层虚拟接口，在网络层工做，配置IP地址，实现Vlan间的通信
vlan聚合：
		节约IPv4,主要应用：校园网
		端口隔离（可以再同一个vlan内，隔离端口）
DHCP 动态分配IP地址等网络参数  集中管理分配的IP
1）发现阶段：客户端广播发送 dhcp discover 报文
	作用：发现dhcp 服务器，请求IP
	MAC地址：主机的mac
	源IP：0.0.0.0：未分配的IP地址，通常代表本机
	目标ip：255.255.255.255：广播地址
2）提供阶段：服务器收到discover报文后，单播回复offer报文
3）选择阶段：客户端收到offer报文后，会发送dhcp request
4）确认阶段：服务器客户端发送的request 报文后，会单播回复dhcp ack

等价路由
	去往同一个目的地，有俩条路
	目的掩码相同，优先级相同，cost相同，但是下调和接口不同，这种路由叫等价路由。
等交路由如何工作：轮询（根据数据流进行轮询）
	缺点：数据转发的路径不唯一，数据转发路径不对称。
所以需要配置浮动路由：路由备份
	默认情况下，只有一条路径转发数据流量，另一条路径是备份路径，不转发流量。
	只有主路径故障时，备份路由才浮出(默认·优先级为60，越小越优先）
	VRRP 把多台路由设备联合组成一台虚拟的路由配置一个虚拟网关IP地址
	虚拟网关IP地址作为主机的网关，实现路由备份
虚拟路由器冗余协议:
	由IETF标准RFC2338定义，是公有协议，任何厂商设备都支持
	VRRP协议位于OSI模型第三层网络层，协议号为122
	VRRP发送报文的方式为组播，地址为：224.0.0.18
	VRDID　虚拟路由标识符	（默认·优先级为100，越大越优先）
	一个VRRP组成多台路由（的接口）组成，相同的VRID进行标识。
	同一个VRRP组成的路由器之间交互VRRP协议报文产生一台虚拟路由器
	一个VRRP组中只能出现一个Master路由器

### 子网划分
#### 前言
IPv4:32个bit
IPv4的组成：网络位+主机位
子网掩码的长度：32个bit
单播地址：
	A:  0   - 127
	B:128 - 191
	C:192 - 223
组播地址:
	D:224 - 139
保留：
	E:240 - 255
==网络位越长，主机位越短，这个网段下IP地址就越少 #41AE3C==
==网络位越短，主机位越长，这个网段下IP地址就越多 #41AE3C==

----
子网划分的原因
   - 节省IP地址，减少IP地址的浪费
   - 满足不同网络对IPv4的需求
   - 实现网络设备编址的层次化需求

什么是子网划分：
	  将一个大的网段，划分成多个小的网段，叫做子网划分
子网划分的==作用 #41AE3C==：
	  节约IPv4地址，减少IPv4地址的浪费
如何划分：
	  让网络位变长，让主机位变短，一个大的网段就可以划分成多个小的子网，每一个网段内的IP地址数量变少

子网计算
	子网数=2^n^ (n 代表子网位数)
	主机数=2^N^ (N代表主机位数)
等长的子网划分：
	将一个大的网段平均分配给多个相等大小的子网网段(每个子网中IP地址数量相等)
不等长的子网划分：
	- 可变长的子网划分：VLSM
	- 一个大的网段划分成几个小的子网，每个子网的掩码长度不同，每个子网内的IP地址数量也不同



### BFD
1. BFD技术背景？
	1) 不能快速有效的发现网络设备或链路出现的故障
	2) 不能以毫秒级的速度发现问题
	3) 协议自身的报文检测机制一般都大于一秒
2. BFD的作用是什么？原理是什么？
	1) 作用：双项转发检查机制，用于快速检测、监控网络或IP路由的转发连通状况
	2) 原理：BFD的检测机制是两个系统建立BFD会话，并沿他们之间的路径周期性发送BFD控制报文，如果一方在既定的时间内没有收到BFD控制报文，则认为路径上发生了故障
3. BFD的优点？
	对于任何介质、任何协议层进行实时且快速的检测
4. BFD是如何实现快速链路检测呢?
	1)BFD先建立会话
	2)会话建立成功后，会话两端的设备周期性的发送BFD控制报文，默认是1秒发送1次
	当3倍的发送周期没有收到对端设备发来的bfd控制报文，就认为链路出现故障
	3) BFD和其他协议进行联动，通知上层协议，链路故障
5. BFD常见会话参数
	BFD控制报文是周期性发送，发送间隔时间默认是1000亳秒( 1000ms)--路由器可以改10ms ( 交换机100
	接收间隔时间默认是1000毫秒	
	本地检测倍数：3倍
	
双向转发机制
特点：
		快速的检测链路故障，以毫秒级的速度发现链路故障
		对于任何介质、任何协议层进行实时且快速的检测
	作用：
		专门发送超小以及超快的检测数据包，快速检测链路故障，改善网络性能
		当链路发送故障的时候，通知相关的设备和协议进行快速处理，快速的恢复通信
	工作原理：当链路发送故障的时候，通知相关的设备和协议进行快速处理，快速的恢复通信
	



==操作命令： #CC5595== 
bfd *开启BFD*
bfd ntd666 bind peer-ip 192.168.12.1    *==BFD绑定IP #41AE3C==*
discriminator local   ==X #EE3F4D==    *==设置本地标识符 #41AE3C==*
discriminator remote  ==Y #EE3F4D==	 *==设置对方标识符 #41AE3C==*
min-tx-interval 10	*==发送心跳 #41AE3C==*
min-rx-interval 10	  *==接收心跳 #41AE3C==*
ip route-static 192.168.20.24 track bfd-session ntd666  *==绑定路由 #41AE3C==*
vrrp vrid 10 track bfd-session    ==Y  #EE3F4D== incereased 80 *==配置VRRP和BRFD联动，一旦发现BFD会话down掉就会迅速让当前设备优先级增加80 #41AE3C==*	

---
### ACL 
ACL：访问控制列表：报文过滤器
作用:对网络中的数据报文进行过滤，做访问控制，提高内网的安全性，提高带宽利用率
ACL的分类:
- 基本ACL: 2000- 2999
	特点:只能过滤源IP地址
- 高级ACL: 3000-3999
	特点:可用过滤五元组:源IP，目的IP，协议号，源端口，目的端口
	> rule 10 permit tcp source 192.168.1.1 0.0.0.0 destination-port eq 80

ACL的组成:
	ACL编号: ACL的名字: acl 2000 acl 20001 acl 2002
规则:
	1. 规则编号: rule 10s rule 20 rule 30
	2. 动作:允许: permit 和拒绝deny

ACL匹配原则：
	1) 根据acl规则号，从小到大
	2)一旦匹配即停止：如果数据报文匹配到第一条规则，则按照第一条规则的动作去执行，不会向下查找第二条
	3)如果没有匹配到第一条规则，继续向下查找第二条规则
       如果匹配，按照动作执行
       如果不匹配继续查找下一条规则
	4) 如果这条数据报文，所有的规则都匹配不上，则执行隐含规则
        隐含规则有两种，一个是允许所有，一个是拒绝所有
                允许所有:当acl和traffic-filter 联动
                拒绝所有:当ACL不和traffic- filter联动时
5)通配符：检查0，忽略1
命令：
>acl 2000		创建基本acl 2000
>step X       修改步长为X[1<X<20],默认为5
>rule 10 deny source 192.168.1.1 0.0.0.0			拒绝IP为192.168.1.1的数据报文
>rule 20 permit source 192.168.1.0 0.0.0.255
>int g0/0/0    
>traffic-filter outbound acl 2000	在g0/0/0出接口调用acl规则
解析：rule 10：表示规则编号为10
deny:拒绝
permit：允许
source192.168.1.1：过滤数据报文的源IP
traffic-filter：流量过滤
outbound：出向

ACL有隐含规则
1）允许所有：当acl规则和traffic-filter联动的时候，默认允许所有
2）拒绝所有：当acl规则不和traffic-filter联动的时候，默认拒绝所有

## NAT
NAT: 网络地址转换
1.为什么会有NAT地址
原因：节约IPv4地址：
- IPv4地址不足，为了节约IPv4地址，所以将IPv4地址划分为公有和私有
-企业内网王机使用私有IP地业，私有IP地址在不同的企业内部可用重用
出现问题:私有IP地址，无法上网
- 私有IP地址， 无法访问互联网应用
	为什么?因为公网的设备不会给私有IP地址做路由，
	所以导致企业内网的主机访问互联网应用时，数据无法回报
	所以需要NAT:网络地址转换
如何解决私有IP地址上网问题呢，如何解决数据能够回来的问题
NAT会建立NAT会话转换表
当企业内网的主机访问互联网应用时，
NAT会将发出去的数据报文-IP报头中的源IP地址，由私有IP地址转化为公有IP地址
访问互联网应用，外网的数据回来的时候，也会查找NAT会话转换表
将目的IP地址由公有IP地址，再转换回私有IP地址
总结: NAT是根据NAT会话转换表进行工作的
- 数据从内网访问外网时，查表转换，转换的是源IP地址，由私转公
- 数据从公网回包时，也会查表转换，转换的是目的IP地址，由公转私


NTA作用：
- 对IP包头中的私有IP地址和公有IP地址进行转换，实现企业内网到外网的访问
- 隐藏企业内网主机，提高网络的安全性

企业内网主机使用私有Ip地址，是无法访问互联网应用的
因为公网的路由器，不会给私有Ip地址做路由
所以数据永远无法回来，所以无法上网
那应该怎么办: 有一个技术:nat
网络地址转换:
怎么转换，把内网主机访问互联网的数据报文中--IP报头里面的
把IP报头里面的源IP，由私有IP改为公有IP地址.
命令：
> nat static global 100.1.1.3 inside 192.168.1.1 
global：全局的，全球的。后面跟公网IP
inside：后面跟内网



